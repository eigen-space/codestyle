# Общие стандарты web-разработки

## 1. Файлы с исходным кодом

### 1.1. Правила именования

1. Имя файла должно быть в нижнем регистре.

```
    // Плохо
    Tag.ts

    // Хорошо
    tag.ts
```

2. Имя файла может содержать логические группы. Группы разделяются точкой (символ **.**). 

3. Если имя файла состоит из нескольких слов, то они разделяются дефисом (символ **-**).

```
    // Плохо
    progress_bar.ts

    // Хорошо
    progress-bar.ts
```

### 1.2. Кодировка

Файлы с исходным кодом должны использовать кодировку UTF-8.

### 1.3. Используемые специальные символы

#### 1.3.1. Пробельные

В качестве пробельного символа должен использоваться только символ пробела (0x20). 
Не должно быть использования других пробельных символов. Исключением является только 
символ завершения строки.

Таким образом, в качестве символа для определения **отступов** также используемся 
**символ пробела**. Использование **символа табуляции недопустимо**. Величина отступов 
и их оформление указаны в **п.3.2**.

#### 1.3.2. Использование управляющих последовательностей символов

Если управляющая последовательность имеет своё символьное представление, 
то следует использовать его, нежели использовать её числовое выражение:

```typescript
    // Плохо
    '\x0a', '\u000a', '\u{a}'

    // Хорошо
    '\'', '\"', '\\', '\b', '\f', '\n', '\r', '\t'
```

#### 1.3.3. Символы вне таблицы ASCII символов

Использовать управляющую последовательность unicode для представления символа, 
если он является непечатаемым символом. При использовании таких символов обозначать 
их через константу с однозначным и понятным названием, которое раскрывает смысл 
используемого символа.

```typescript
    // Плохо
    const currency = '\u20bd';
    // Плохо
    result = '\ufeff' + 'content';
    
    // Хорошо
    const currency = '₽';
    // Хорошо
    const MARK_OF_BYTE_ORDER = '\ufeff';
    result = MARK_OF_BYTE_ORDER + 'content'; 
```

## 2. Структура каталогов

Проект должен придерживаться следующей структуры:

```
    /src - Файлы, используемые приложением
        /app - Код приложения (модули, шаблоны, логика)
            /common - Общие для модулей приложения сущностями, перечислениями и т.д.
                /<concrete group>
                    *.ts
                    *.spec.ts
                    *.html
            /<module> - Модуль приложения. Например, экран мониторинга, экран планирования
                /<sub_module> - Часть экрана, которая более нигде не используется
                    *.ts
                    *.spec.ts
                    *.html           
            <app root files> - Корневой модуль, файл запуска приложения, корневой шаблон
        /assets - Дополнительные ресурсные файлы
            /favicon - Набор иконок, которые используются для отображения на вкладке браузера, в плитке приложений, ...
                <favicons>
            /fonts - Шрифты
                /<font> - Конкретный шрифт в разных разрешениях
                    *.ttf
                    *.woff
                    *.woff2
            ...
        /data - Заглушки на backend API
            *.tson
        /environments - Наборы констант приложения под разные среды
            environment.prod.ts
            environment.ts   
            ...
        ...
    package.tson - Файл, определяющий зависимости на сторонние для проекта библиотеки
    package-lock.tson - Файл, фиксирующий конкретные номера зависимостей
    README.md
    <другие корневые файлы конфигурации> - Например, karma.conf.ts, .gitignore, .gitlab-ci.yml, .npmrc, ...
            
```

Пример структуры:

```
    /src
        /app
            /common
                /components
                    /base
                        base.component.ts
                        base.component.spec.ts
                    /list
                        list.component.ts
                        list.component.spec.ts
                        ...
                    ...
                /entities
                    /tag
                        tag.ts
                        tag.spec.ts
                    /demand
                        demand.ts
                        demand.spec.ts
                    ...
                /enums
                    job_status_type.ts
                    ...
                /exceptions
                    /app_error
                        app_error.ts
                        app_error.spec.ts
                /services
                    /data_loader
                        data_loader.service.ts
                        data_loader.service.spec.ts
                    /job
                        job.service.ts
                        job.service.spec.ts
                    ...
                /utils
                    /logger
                        logger.ts
                        logger.spec.ts
                    ...
            /monitor
                monitor.component.ts
                monitor.component.spec.ts
                monitor.module.ts
            /plan
                ...
            ...
            app.module.ts
            app.routes.ts
        /assets
            /fonts
                /rubik
                    rubik_regular.ttf
                    rubik_regular.woff
                    rubik_regular.woff2
        /data
            zones.list.tson
            ...
        /environments
            environment.prod.ts
            environment.ts
    .editorconfig
    .eslint.ts
    .gitattributes
    .gitignore
    .gitlab_ci.yml
    .htmlhintrc
    .npmrc
    package.tson
    package_lock.tson
    webpack.config.ts
```

## 3. Форматирование

### 3.1. Длина строк

Длина строк не должна превышать **120 символов**. Строка не может быть чуть-чуть длиннее 
указанной границы. Либо строка соответствует установленному лимиту, либо нет. 
Если строка превышает ограничение, нужно переносить её части в соответствии с 
правилами переноса выражений, указанными в разделе **3.5. Перенос выражений**.

**Исключения** составляют только следующие случаи:

* строки, которые не разорвать, например, длинный URL в JSDoc. С похожей ситуацией 
  можно столкнуться в json-файлах, которые также встречаются в проектах на javascript.

```typescript
    /**
     * ...
     * Поясняющий пример можно найти по ссылке:
     * http://www.theblaze.com/blog/2011/02/01/kansas-city-star-complains-about-the-lack-of-response-during-his-response-to-the-response-to-his-response-to-a-point-he-didnt-hear-and-doesnt-understand
     */
```

### 3.2. Пробельные места

Файл должен завершаться строкой с содержимым, не должно быть пустой строки в конце файла.

## 4. Политики

### 4.1. Код не соответствует правилам руководства

a. Если вносятся существенные изменения в файл, который не соответствует принятым в настоящем 
руководстве правилам, то следует предварительно выполнить форматирование файла в соответствии 
с правилами.

b. Если вносятся незначительные изменения в файл, то привести к формату правил только тот 
участок кода, в который вносятся изменения.

c. Новый код должен соответствовать правилам руководства.

### 4.2. Сгенерированный код

Сгенерированный код, который используется в проекте, может не соответствовать правилам 
руководства. Однако имена идентификаторов, которые используются в проекте должны соответствовать 
правилам настоящего руководства. Это соответствие должно быть обеспечено либо на уровне 
генерируемого кода, либо на уровне приложения за счёт дополнительных преобразований.

### 4.3. Автоматизированные инспекции кода и фиксация изменений

Необходимо уделять внимание автоматизированным инспекция в IDE и инспекциям инструмента 
проверки кода `eslint` / `tslint`. Недопустимо выполнять фиксацию кода в репозитории,
если он не проходит проверку на соответствие принятому стандарту написания кода.  

## 5. Система контроля версий

### 5.1 Правила именования

#### 5.1.1 Ветка

Необходимо придерживаться следующего формата именования веток: 

`<тип задачи>/<номер задачи>-<краткое описание>`,

где

* тип задачи - новый функционал (feature), дефект (bug);
* номер задачи - номер задачи в системе учёта задач (gitlab), например 107;
* краткое описание - название задачи (допустим более краткий вариант) на английском языке (не транслитом) 
в kebab-case.

``` 
// Плохо
issue-241-dictionary-infobar-route-stops
feature/241
bug/301

// Хорошо
feature/241-dictionary-infobar-route-stops
bug/301-broken-infobar-dropdown
```

#### 5.1.2 Сообщение к изменению

a. При фиксации изменения обязательно используется сообщение, описывающее изменение.

b. Сообщение должно описывать состав изменений и причину (назначение) изменения.

c. Сообщение должно иметь следующий формат:

```
<номер задачи> <модуль 1>[/<подмолуль>][, ..., <модуль N>[/<подмодуль>]]: <состав и семантика изменения 1>[, 
..., <состав и семантика изменения M>][; ...; <модуль K>[/<подмодуль>]: <состав и семантика изменения>]
```

Таким образом, самый простой вид сообщения:

```
<номер задачи> <модуль>: <состав и семантика изменения>
```

Разновидность наиболее насыщенного изменения:

```
<номер задачи> <модуль 1>/<подмолуль>, <модуль 2>/<подмодуль>: <состав и семантика изменения 1>, 
<состав и семантика изменения 2>]; <модуль 3>: <состав и семантика изменения>
```

где

  * `<номер задачи>` - корректный путь до задачи, который в идеальном случае обеспечивает
    связь изменения в репозитории и задачи на уровне ссылки. Например, `#17`, `CD-11`, 
    `inni/issues#104`;
  * `<модуль>` - название модуля, внутри которого вносится изменение. Модулем в данном случае
    называется любая директория в корне проекта, если эта директория вне директории `src` или
    любая директория внутри директории `src` (или директории, считающейся корнем исходного
    кода приложения). Если изменение касается проекта в общем, т.е. изменени структуры,
    изменение состава зависимостей, npm-скриптов и т.д., то в качестве модуля проставляется
    `common`. `common` также может относится к изменению в директории общего для модулей кода.
    Если изменение касается процесса непрерываной интеграции (continuous integration),
    то такое изменение отмечается: `ci`;
  * `<подмодуль>` - название подмодуля внутри модуля. Подмодулем считается директория 
    внутри директории модуля;
  * `<состав и семантика изменения>` - описание того, что и зачем было изменено.

Разделители:

  * `<номер задачи>` отделяется пробелом ` ` от остальной части сообщения;
  * `<модуль>` и `<подмодуль>` разделяются слешем `/`;
  * Группы `<модуль>/<подмодуль>` отделяются друг от друга запятой `,`;
  * `<модуль>/<подмодуль>` и `<состав и семантика изменения>` разделяются двоеточием `:`;
  * Группы `<модуль >: <состав и семантика изменения>` отделяются друг от друга точкой с запятой `;`;
  * Группы `<состав и семантика изменения>` отделяются друг от друга запятой `,`

В квадратных скобках `[]` указаны части сообщения, которые могут отсутствовать. 
Остальные составляющие являются обязательными.

Примеры:

```
// Структура проекта
data-collectors <root of project>
    /dev
        /db
            /data
            /model
            /queries
    /src
        /common
            /services
                /data
        /instrument
        /report
    package.json

// Плохо

// Отсутствует суть изменений
#287 common: review fixes
// Нет номера задачи, в указании модуля присутствует название проекта и указана излишняя вложенность
data-collectors/report/pasrer/historical: optimized parsing of the dom to get 2x speed of parsing

// Хорошо
inni/issues#104 common: added script to update dependencies to cure integrity check error
inni/issues#105 instrument: changed source of data from source1 to source2 to get more stable data stream
inni/issues#106 dev/db: changed type of the field `value` of report to store data from different sources;
report: implemented new service to get data from some new source of data.
inni/issues#107 common/services: added new service `report data service` to get report data from database
```

d. Не должно быть вложенности больше `<модуль>/<подмолуль>`, т.е. максимальная точность
указания изменения ограничивается вложенностью второго уровня. Если изменение касается
двух подмодулей одного модуля, то оба варианта записи сообщения об изменении являются
приемлемыми:

```
// Вариант 1. Сообщение разбито по подмодулям
<номер задачи> <модуль 1>/<подмолуль 1>: <состав и семантика изменения>; 
<модуль 1>/<подмодуль 2>: <состав и семантика изменения>

// Вариант 2. Сообщение сгруппировано по модулю
<номер задачи> <модуль 1>: <состав и семантика изменения с указанием, что оно сделано в подмодуле 1>,
<состав и семантика изменения с указанием, что оно сделано в подмодуле 2>; 
```

e. Не должно быть точки в конце сообщения.

f. Сообщение должно быть на английском языке, не должно быть транслита.

g. Каждая часть изменения, т.е. `<состав и семантика изменения>`, начинается с глагола
в прошедшем времени, т.е. описывает, что было сделано: `added ...`, `fixed ...`, ...

h. Исключение формата сообщения составляют автоматические фиксации изменений, 
выполняющиеся в процессе автоматизированной сборки и развёртывания, а также изменения
в результате слияния веток.

i. Формат сообщения при фиксации изменения в процессе автоматизированной сборки:

```
auto/ci: <текст сообщения>
```

Примеры:

```
auto/ci: set version 0.1.24
```

j. Формат сообщения при слиянии веток:

```
// Слияние ветки <название ветки> -> master
Merge branch '<название ветки>'

// Слияние ветки <название ветки 1> -> <название ветки 2>
Merge branch '<название ветки 1>' into <название ветки 2>
```

Примеры:

```
Merge branch 'dev'
Merge branch 'feature/101-automate-rules-of-object-formatting' into dev
```

k. Вместо номера задачи в редких случаях, когда требуется внести очень мелкое изменение,
под которое не имеет смысла создавать задачу (исправление опечатки, корректировка какой-то
случайной проблемы), может указываться слово `microfix`.

```
microfix common: added comment to skipped specs
```

### 5.2 Правила работы с репозиторием

#### 5.2.1 Внесение изменений

a. Предпочтительнее фиксировать небольшие и законченные изменения.

b. Небольшие изменения, которые отмечаются `microfix`, могут вноситься сразу в рабочую
ветку `dev`. Если изменение вызывает сомнение в стабильности, оно должно быть выполнено
либо через задачу, либо через запрос на вливание этого изменения, чтобы оно прошло ревью. 